<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>åå°ç®¡ç†</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<div class="container" style="margin-top:20px; display:flex; justify-content:space-between; align-items:center;">
  <h1>ğŸ“° æ–°é—»å†…å®¹ç®¡ç†</h1>
  <a href="/" class="btn btn-secondary">å›åˆ°é¦–é¡µ</a>
</div>

<div class="container admin-layout">
  <!-- å·¦ä¾§ï¼šè¡¨å• -->
  <div class="admin-card">
    <h2 id="form-title" style="margin-top:0;">å‘å¸ƒæ–°é—»</h2>
    <form action="/admin/save" method="post">
      <input type="hidden" name="id" id="news-id">

      <div class="form-group">
        <label>æ ‡é¢˜</label>
        <input type="text" name="title" id="news-title" class="form-control" required>
      </div>

      <div class="form-group">
        <label>åˆ†ç±»</label>
        <select name="category" id="news-category" class="form-control">
          <option value="education">æ•™è‚²</option>
          <option value="entertainment">å¨±ä¹</option>
          <option value="games">æ¸¸æˆ</option>
          <option value="health">å¥åº·</option>
          <option value="tech">ç§‘æŠ€</option>
        </select>
      </div>

      <div class="form-group">
        <label>å†…å®¹</label>
        <textarea name="content" id="news-content" rows="10" class="form-control" required></textarea>
      </div>

      <button type="submit" class="btn btn-primary" style="width:100%;">ä¿å­˜ / æ›´æ–°</button>
      <button type="button" onclick="resetForm()" class="btn btn-secondary" style="width:100%; margin-top:10px;">æ¸…ç©º / æ–°å¢æ¨¡å¼</button>
    </form>
  </div>

  <!-- å³ä¾§ï¼šåˆ—è¡¨ -->
  <div class="admin-card">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
      <h2 style="margin:0;">å·²å‘å¸ƒåˆ—è¡¨</h2>
      <form action="/admin" method="get" class="search-box" style="border:1px solid #ddd;">
        <input type="text" name="keyword" placeholder="æœæ ‡é¢˜...">
        <button type="submit" class="search-btn">ğŸ”</button>
      </form>
    </div>

    <table class="data-table">
      <thead>
      <tr>
        <th>æ ‡é¢˜</th>
        <th width="50">åˆ†ç±»</th>
        <th width="120">æ“ä½œ</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="news : ${allNews}">
        <td th:text="${news.title}"></td>
        <td><span th:class="'tag tag-' + ${news.category}" th:text="${news.category}"></span></td>
        <td>
                            <span class="btn-link" style="cursor:pointer;"
                                  th:data-id="${news.id}"
                                  th:data-title="${news.title}"
                                  th:data-category="${news.category}"
                                  th:data-content="${news.content}"
                                  onclick="editNews(this)">
    ç¼–è¾‘
</span>
          <a th:href="@{/admin/delete/{id}(id=${news.id})}" class="btn-danger" onclick="return confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')">åˆ é™¤</a>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  function editNews(btn) {
    // 1. è·å–æ•°æ®
    // æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨ getAttribute æ˜¯æœ€ç¨³å¦¥çš„æ–¹æ³•
    var id = btn.getAttribute('data-id');
    var title = btn.getAttribute('data-title');
    var category = btn.getAttribute('data-category');
    var content = btn.getAttribute('data-content');

    console.log("æ­£åœ¨ç¼–è¾‘ ID:", id, "æ ‡é¢˜:", title); // æ–¹ä¾¿ä½ åœ¨æ§åˆ¶å°è°ƒè¯•

    // 2. å¡«å……è¡¨å•
    // ä¿®æ”¹æ ‡é¢˜æ˜¾ç¤º
    document.getElementById('form-title').innerText = "ä¿®æ”¹æ–°é—» (ID: " + id + ")";

    // å¡«å……éšè—çš„ ID è¾“å…¥æ¡† (å…³é”®ï¼å¦åˆ™ä¿å­˜æ—¶ä¼šå˜æˆæ–°å¢)
    document.getElementById('news-id').value = id;

    // å¡«å……å…¶ä»–å­—æ®µ
    document.getElementById('news-title').value = title;
    document.getElementById('news-category').value = category;
    document.getElementById('news-content').value = content;
  }

  function resetForm() {
    document.getElementById('form-title').innerText = "å‘å¸ƒæ–°é—»";
    document.getElementById('news-id').value = "";
    document.getElementById('news-title').value = "";
    document.getElementById('news-content').value = "";
    document.getElementById('news-category').value = "education"; // é‡ç½®ä¸ºé»˜è®¤é€‰é¡¹
  }
</script>
</body>
</html>